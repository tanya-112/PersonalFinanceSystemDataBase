/* Подсчет общей суммы расходов за период по всем подкатегориям вместе(или можно сделать, категориям) */
create procedure ПодсчетРасходовЗаПериод @КодАккаунта as int, @НачалоПериода as date, @КонецПериода as date, @Расход as money output
as
begin
select @Расход=sum(Расходы.Сумма) from Расходы inner join Счета on Расходы.КодСчета=Счета.КодСчета inner join Аккаунты on Счета.КодАккаунта=Аккаунты.КодАккаунта
where Дата between @НачалоПериода and  @КонецПериода and Счета.КодАккаунта=@КодАккаунта
end
go

declare @Расход money
exec ПодсчетРасходовЗаПериод 3,'3/06/2015','3/06/2015', @Расход output 
print @Расход
/* СДЕЛАТЬ, ЧТОБ РАБОТАЛ ТАКОЙ ВАРИАНТ!!!!!!!!
select 'Расходы с '+ @НачалоПериода+' по ' +@КонецПериода+' составляют '+ @Расход + 'грн' 
*/









/* Подсчет суммы расходов за период по каждой из подкатегорий(или можно сделать, категорий) */
create procedure ПодсчетРасходовЗаПериодсПодкатегориями @КодАккаунта as int, @НачалоПериода as date, @КонецПериода as date
as
begin
select sum(Расходы.Сумма), Подкатегории.НазваниеПодкатегории
from Расходы inner join Подкатегории on Расходы.КодПодкатегории=Подкатегории.КодПодкатегории
inner join Счета on Расходы.КодСчета=Счета.КодСчета
inner join Аккаунты on Счета.КодАккаунта=Аккаунты.КодАккаунта
where Дата between @НачалоПериода and  @КонецПериода and Счета.КодАккаунта=@КодАккаунта
group by Подкатегории.НазваниеПодкатегории
end
go


declare @Расход money
exec ПодсчетРасходовЗаПериодсПодкатегориями 1,'1/06/2015','14/06/2015'




/* СДЕЛАТЬ, ЧТОБ РАБОТАЛ ТАКОЙ ВАРИАНТ!!!!!!!!
/* Подсчет общей суммы расходов за период по конкретной подкатегории (или можно сделать, категории) */
create procedure ПодсчетРасходовЗаПериодПоПодкатегории @КодАккаунта as int, @НачалоПериода as date, @КонецПериода as date, @КодПодкатегории as int, @Расход as money output
as
begin
select @Расход=sum(Расходы.Сумма)
from Расходы inner join Подкатегории on Расходы.КодПодкатегории=Подкатегории.КодПодкатегории
inner join Счета on Расходы.КодСчета=Счета.КодСчета
inner join Аккаунты on Счета.КодАккаунта=Аккаунты.КодАккаунта
where Дата between @НачалоПериода and  @КонецПериода and Счета.КодАккаунта=@КодАккаунта and Подкатегории.КодПодкатегории=@КодПодкатегории
end
go


declare @Расход money
exec ПодсчетРасходовЗаПериодПоПодкатегории 1,'1/06/2015','14/06/2015',2, @Расход output 
print 'Расходы на выбранную подкатегорию с '+ @НачалоПериода+'по '+@КонецПериода+' составили: '+@Расход+'грн'
*/



/* Подсчет общей суммы расходов за период по конкретной подкатегории (или можно сделать, категории) */
create procedure ПодсчетРасходовЗаПериодПоПодкатегории @КодАккаунта as int, @НачалоПериода as date, @КонецПериода as date, @КодПодкатегории as int
as
begin
select sum(Расходы.Сумма) as [Сумма Расходов]
from Расходы inner join Подкатегории on Расходы.КодПодкатегории=Подкатегории.КодПодкатегории
inner join Счета on Расходы.КодСчета=Счета.КодСчета
inner join Аккаунты on Счета.КодАккаунта=Аккаунты.КодАккаунта
where Дата between @НачалоПериода and  @КонецПериода and Счета.КодАккаунта=@КодАккаунта and Подкатегории.КодПодкатегории=@КодПодкатегории
end
go


declare @Расход money
exec ПодсчетРасходовЗаПериодПоПодкатегории 1,'1/06/2015','14/06/2015',2


